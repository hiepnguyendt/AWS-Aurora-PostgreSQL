<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.123.1">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Fast Cloning :: AWS RDS PostgreSQL</title>

    
    <link href="/css/nucleus.css?1711417761" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1711417761" rel="stylesheet">
    <link href="/css/hybrid.css?1711417761" rel="stylesheet">
    <link href="/css/featherlight.min.css?1711417761" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1711417761" rel="stylesheet">
    <link href="/css/auto-complete.css?1711417761" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1711417761" rel="stylesheet">
    <link href="/css/theme.css?1711417761" rel="stylesheet">
    <link href="/css/hugo-theme.css?1711417761" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1711417761" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1711417761"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/3-fastcloning/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1711417761"></script>
<script type="text/javascript" src="/js/auto-complete.js?1711417761"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1711417761"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Introduction" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/">
           <b> 1. </b> Introduction
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-preparation/" title="Preparation Steps" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/">
           <b> 2. </b> Preparation Steps
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-1-createvpc/" title="Create a VPC" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-1-createvpc/">
           <b> 2.1. </b> Create a VPC
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-2-createsg/" title="Create Security Group " class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-2-createsg/">
           <b> 2.2. </b> Create Security Group 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-3-createec2/" title="Create a EC2 instance" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-3-createec2/">
           <b> 2.3. </b> Create a EC2 instance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-4-createpgsg/" title="Create Subnet Group and Parameter Group" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-4-createpgsg/">
           <b> 2.4. </b> Create Subnet Group and Parameter Group
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-5-createaupg/" title="Create Aurora PostgreSQL Database" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-5-createaupg/">
           <b> 2.5. </b> Create Aurora PostgreSQL Database
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-preparation/2-6-configurecloud9andinitializedatabase/" title=" Create, Configure Cloud9 and Initialize Database" class="dd-item 
        
        
        
        ">
      <a href="/2-preparation/2-6-configurecloud9andinitializedatabase/">
           <b> 2.6.</b>  Create, Configure Cloud9 and Initialize Database
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-fastcloning/" title="Fast Cloning" class="dd-item 
        
        active
        
        ">
      <a href="/3-fastcloning/">
           <b> 3. </b> Fast Cloning
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-queryplanmanagement/" title="Query Plan Management" class="dd-item 
        
        
        
        ">
      <a href="/4-queryplanmanagement/">
           <b> 4. </b> Query Plan Management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-clustercachemanagement/" title="Cluster Cache Management" class="dd-item 
        
        
        
        ">
      <a href="/5-clustercachemanagement/">
           <b> 5. </b> Cluster Cache Management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/5-clustercachemanagement/5-1-setupclustercachemanagement/" title="Setup cluster cache management" class="dd-item 
        
        
        
        ">
      <a href="/5-clustercachemanagement/5-1-setupclustercachemanagement/">
           <b> 5.1. </b> Setup cluster cache management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-clustercachemanagement/5-2-benchmarkingwithclustercachemanagement/" title="Benchmarking with Cluster Cache management" class="dd-item 
        
        
        
        ">
      <a href="/5-clustercachemanagement/5-2-benchmarkingwithclustercachemanagement/">
           <b> 5.2. </b> Benchmarking with Cluster Cache management
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-databaseactivitystreaming/" title="Database activity streaming" class="dd-item 
        
        
        
        ">
      <a href="/6-databaseactivitystreaming/">
           <b> 6. </b> Database activity streaming
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/6-databaseactivitystreaming/6-1-setupkmsfordatabaseactivitystreamsinaction/" title="Setup KMS for Database Activity Streaming" class="dd-item 
        
        
        
        ">
      <a href="/6-databaseactivitystreaming/6-1-setupkmsfordatabaseactivitystreamsinaction/">
           <b> 6.1. </b> Setup KMS for Database Activity Streaming
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/6-databaseactivitystreaming/6-2-dbactivitystreamsinaction/" title="Database Activity Streams in action" class="dd-item 
        
        
        
        ">
      <a href="/6-databaseactivitystreaming/6-2-dbactivitystreamsinaction/">
           <b> 6.2. </b> Database Activity Streams in action
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-rdsperformanceinsights/" title="RDS Performance Insights" class="dd-item 
        
        
        
        ">
      <a href="/7-rdsperformanceinsights/">
           <b> 7. </b> RDS Performance Insights
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/8-createdatasetandautoscale/" title="Create dataset and Auto Scale" class="dd-item 
        
        
        
        ">
      <a href="/8-createdatasetandautoscale/">
           <b> 8. </b> Create dataset and Auto Scale
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/9-testfaulttolerance/" title="Test Fault Tolerance" class="dd-item 
        
        
        
        ">
      <a href="/9-testfaulttolerance/">
           <b> 9. </b> Test Fault Tolerance
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/9-testfaulttolerance/9-1-setupfailovereventnotifications/" title="Set up failover event notifications" class="dd-item 
        
        
        
        ">
      <a href="/9-testfaulttolerance/9-1-setupfailovereventnotifications/">
           <b> 9.1. </b> Set up failover event notifications
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/9-testfaulttolerance/9-2-testamanualdbclusterfailover/" title="Test a manual DB cluster failover" class="dd-item 
        
        
        
        ">
      <a href="/9-testfaulttolerance/9-2-testamanualdbclusterfailover/">
           <b> 9.2. </b> Test a manual DB cluster failover
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/9-testfaulttolerance/9-3-testingfaultinjectionqueries/" title="Testing fault injection queries" class="dd-item 
        
        
        
        ">
      <a href="/9-testfaulttolerance/9-3-testingfaultinjectionqueries/">
           <b> 9.3 </b> Testing fault injection queries
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/10-comparationrdspgandaupg/" title="Comparison RDS PostgreSQL and Aurora PostgreSQL" class="dd-item 
        
        
        
        ">
      <a href="/10-comparationrdspgandaupg/">
           <b> 10. </b> Comparison RDS PostgreSQL and Aurora PostgreSQL
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/11-cleanup/" title="Clean up resources" class="dd-item 
        
        
        
        ">
      <a href="/11-cleanup/">
           <b> 11. </b> Clean up resources
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="//localhost:1313/3-fastcloning/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="vi" value="//localhost:1313/vi/3-fastcloning/">Tiếng Việt</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>30-01-2022</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
                <a href="https://www.linkedin.com/in/hiepnguyendt"  style="color:orange">Thanh Hiệp </a>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            <a href='/'>AWS Aurora PostgreSQL</a> > Fast Cloning
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Fast Cloning
            </h1>
          

        



	<p><strong>What&rsquo;s the Fast Cloning ?</strong>

<div class="expand">
    <div class="expand-label" style="cursor: pointer;" onclick="$h = $(this);$h.next('div').slideToggle(100,function () {$h.children('i').attr('class',function () {return $h.next('div').is(':visible') ? 'fas fa-chevron-down' : 'fas fa-chevron-right';});});">
        <i style="font-size:x-small;" class="fas fa-chevron-right"></i>
        <span>
        
    	
    	Fast Cloning
    	
    	</span>
    </div>
    <div class="expand-content" style="display: none;">
        <p><strong>Fast cloning</strong> refers to a feature that allows you to quickly and efficiently create an exact copy of your database. This clone shares the same underlying storage with the original database initially, making the process much faster and more cost-effective than traditional methods like full database backups or restoring snapshots.</p>
<p><em><strong>Here are some key points about fast cloning for Aurora PostgreSQL:</strong></em></p>
<p><strong>Speed</strong>: Unlike traditional methods, which can take hours or even days for large databases, fast cloning can create a clone in a matter of minutes, even for multi-terabyte databases.</p>
<p><strong>Efficiency</strong>: The clone initially shares the storage with the source database, meaning no physical data needs to be copied. This saves disk space and reduces storage costs.</p>
<p><strong>Copy-on-write</strong>: When changes are made to either the source database or the clone, new data pages are created instead of modifying existing ones. This ensures data consistency and minimizes impact on both databases.</p>
<p><strong>Multiple uses</strong>: Fast cloning is useful for various scenarios, including application development and testing, database updates, blue/green deployments, and running analytical queries without impacting production.
Here are some resources where you can learn more about fast cloning for Aurora PostgreSQL:</p>
<hr>
<p>Amazon Aurora <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Managing.Clone.html">documentation</a>
Amazon Aurora PostgreSQL blue/green deployment using <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/blue-green-deployments-overview.html">fast database cloning</a>
Amazon Aurora <a href="https://aws.amazon.com/blogs/aws/amazon-aurora-fast-database-cloning/">Fast Database Cloning</a></p>

    </div>
</div></p>
<p>In this lab, we will walk through the process of creating an Aurora fast clone. We will observe the divergence of data and compare the performance between the original and cloned Aurora clusters.</p>
<h4 id="setting-up-the-fast-clone-divergence-test">Setting up the Fast Clone divergence test</h4>
<p>Lets review the tables we have created in the <strong>Create, Configure Cloud9 and Initialize Database</strong> step, which will be used in this lab.</p>
<table>
<thead>
<tr>
<th>Resoures name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>cloneeventtest</td>
<td>Table to store the counter and the timestamp</td>
</tr>
<tr>
<td>statusflag</td>
<td>Table to store the status flag which controls the start/stop counter</td>
</tr>
<tr>
<td>eventerrormsg</td>
<td>Table to store error messages</td>
</tr>
<tr>
<td>cloneeventproc</td>
<td>Function to add data to the cloneeventtest table based on the start counter flag</td>
</tr>
</tbody>
</table>
<h4 id="creating-and-verifying-performance-impact-of-the-fast-clone">Creating and verifying performance impact of the Fast Clone</h4>
<ol>
<li>
<p>Running the pgbench workload on the primary cluster</p>
<p>Before creating a Fast Clone of the primary cluster, we are going to start pgbench test to measure the Transaction per seconds (TPS) metrics on the primary cluster. Open a Cloud9 terminal window (terminal #1) by referring Open Cloud9 Terminal Window section and run the following command. This will run for 30 minutes.</p>
<pre tabindex="0"><code>pgbench --progress-timestamp -M prepared -n -T 1800 -P 60 -c 8 -j 8 -b tpcb-like@1 -b select-only@20 &gt; Primary_results.log
</code></pre></li>
<li>
<p>Verify the environment and run the sample divergence test</p>
</li>
</ol>
<ul>
<li>
<p>In order to verify the data divergence on the primary and the clone cluster, we will be adding sample data using sample tables.</p>
</li>
<li>
<p>We need to open one more Cloud9 terminal window (terminal #2) to connect to Aurora and run the function. To open one more terminal window on your Cloud9 environment, click on <strong>Window</strong> menu and select <strong>new Terminal</strong>.</p>
</li>
<li>
<p>Run the following commands to verify the <strong>delflag</strong> column is set to 0 in the <strong>statusflag</strong> table and there is no data in the table <strong>cloneeventtest</strong>. Execute the function <strong>cloneeventproc()</strong> to start adding sample data.</p>
<pre tabindex="0"><code>psql
select * from statusflag;
select * from cloneeventtest;
select cloneeventproc();
</code></pre><p><img alt="FC" src="/images/3.1/2.png"></p>
<p>At this time (we call as time “T1”), the pgbench workload is running on the source DB cluster and also, we are adding sample data to the table on the primary cluster every 10 seconds.</p>
</li>
</ul>
<ol start="3">
<li>Stop the sample data generation</li>
</ol>
<ul>
<li>
<p>First, at T1+5 minutes we will stop the function execution by manually resetting the delflag column on the table statusflag to 1. Open one more Cloud9 terminal window to connect to Aurora (terminal #3). The pgbench workload will continue to execute on the primary source cluster in terminal #1.</p>
<pre tabindex="0"><code>psql
update statusflag set delflag=&#39;Y&#39;;
</code></pre></li>
<li>
<p>Go back to terminal #2 where we ran cloneeventproc function. Wait for ~60sec until you see the function complete its execution:</p>
<pre tabindex="0"><code>select cloneeventproc();
</code></pre><p><img alt="FC" src="/images/3.1/3.png"></p>
</li>
<li>
<p>Let’s check the number of rows in the table cloneeventtest. We should see 5 or more rows in the table:</p>
<pre tabindex="0"><code>select count(*) from cloneeventtest;
</code></pre><p><img alt="FC" src="/images/3.1/4.png"></p>
</li>
<li>
<p>Let&rsquo;s set proper timezone and check rows in cloneeventtest table:</p>
<pre tabindex="0"><code>SET timezone = &#39;Asia/Ho_Chi_Minh&#39;;
select * from cloneeventtest;
</code></pre><p><img alt="FC" src="/images/3.1/5.png"></p>
</li>
</ul>
<ol start="4">
<li>Create Fast Clone Cluster</li>
</ol>
<ul>
<li>
<p>Once the function execution is stopped (after time T1+5 minutes) we will start creating the Fast Clone of the primary cluster. The pgbench workload on the primary will continue on the primary cluster in terminal#1.</p>
</li>
<li>
<p>Now, we will walk you through the process of <a href="https://docs.aws.amazon.com/AmazonRDS/latest/AuroraUserGuide/Aurora.Managing.Clone.html">cloning a DB cluster</a>. Cloning creates a separate, independent DB cluster, with a consistent copy of your data set as of the time you cloned it. Database cloning uses a copy-on-write protocol, in which data is copied at the time that data changes, either on the source databases or the clone databases. The two clusters are isolated, and there is no performance impact on the source DB cluster from database operations on the clone, or the other way around.</p>
</li>
<li>
<p>Following are the steps to configure the Database Fast clone on your Aurora PostgreSQL cluster:</p>
</li>
</ul>
<p>a. Sign in to the AWS Management Console and open the <a href="https://console.aws.amazon.com/rds/home?#databases:">Amazon RDS console</a> .</p>
<p>b. In the navigation pane, choose Databases and select DB identifier with the cluster name you created as a part of the CloudFormation stack. Click the <strong>Actions</strong> menu at the top and select <strong>Create clone</strong>.</p>
<pre><code>![FC](/images/3/9.png)
</code></pre>
<p>c. Enter <code>aupglabs-clone</code> as <strong>DB Instance Identifier</strong> and Capacity type <strong>Provisioned</strong>.</p>
<ul>
<li>
<p>For <strong>Cluster storage configuration</strong> select <strong>Aurora Standard</strong>.</p>
</li>
<li>
<p>In <strong>Instance configuration</strong> select <strong>Memory optimized classes</strong> and <strong>db.r6g.large</strong>.
<img alt="FC" src="/images/3/10.png">
<img alt="FC" src="/images/3/11.png">
<img alt="FC" src="/images/3/12.png"></p>
</li>
<li>
<p>In the <strong>Connectivity</strong> section, leave with default setting</p>
</li>
<li>
<p>In <strong>Additional Configuration</strong>, pick the <strong>DB cluster parameter group</strong> and <strong>DB parameter groups created</strong> in DB cluster parameter group and DB parameter group drop down menus.
<img alt="FC" src="/images/3/14.png"></p>
</li>
<li>
<p>Enable auto minor version upgrade.</p>
</li>
<li>
<p>Leave rest of the input fields at their default value and click Create clone.
<img alt="FC" src="/images/3/15.png">
<img alt="FC" src="/images/3/16.png"></p>
</li>
<li>
<p>Once you click on the “Create Clone” the status column will show status as “Creating”.
<img alt="FC" src="/images/3/17.png"></p>
</li>
<li>
<p>The clone cluster should be ready after about 10-15 minutes or so. The status column will show as “Available” once the cloned cluster is ready.</p>
<p><img alt="FC" src="/images/3/18.png"></p>
</li>
</ul>
<ol start="5">
<li>Start the sample data divergence process on the primary cluster</li>
</ol>
<ul>
<li>
<p>Once the Clone cluster creation process is kicked off, we will start the sample data generation process on the primary cluster. Any sample data added from this point onwards should only be available on the primary cluster and not on the clone cluster.</p>
<pre tabindex="0"><code>psql 
truncate cloneeventtest; # This will empty the cloneeventtest table, removing all existing rows.Make sure you want to do this as it&#39;s an irreversible operation.
update statusflag set delflag=0; 
select count(*) from cloneeventtest;
select cloneeventproc();
</code></pre><p><img alt="FC" src="/images/3.1/6.png"></p>
</li>
</ul>
<ol start="6">
<li>Verify the data divergence on the Clone Cluster</li>
</ol>
<ul>
<li>
<p>Clone cluster should be ready after about 15 minutes or so (time T1+~10-15 minutes).</p>
</li>
<li>
<p>The table “cloneeventtest” on the cloned cluster should have the snapshot of data as it existed on the primary cluster at ~T1+5, because that is when we started creating the clone.</p>
</li>
<li>
<p>Copy the Writer Endpoint for your cloned aurora cluster by clicking the cluster name and going to the <strong>Connectivity &amp; security</strong> tab.</p>
<p><img alt="FC" src="/images/3/20.png"></p>
</li>
<li>
<p>Connect to Aurora cloned cluster from session#3 window. Replace <!-- raw HTML omitted --> below with the Writer endpoint for your Cloned Aurora cluster you copied above.</p>
<pre tabindex="0"><code>psql -h &lt;Cloned Cluster Writer Endpoint&gt;
</code></pre><p><img alt="FC" src="/images/3.1/7.png"></p>
</li>
<li>
<p>And run the sql commands to check the content of the data:</p>
<pre tabindex="0"><code>select count(*) from cloneeventtest;
SET timezone = &#39;Asia/Ho_Chi_Minh&#39;;
select * from cloneeventtest;
</code></pre><p><img alt="FC" src="/images/3.1/8.png"></p>
</li>
<li>
<p>Stop the function run on Primary aurora cluster that is currently running (follow step <strong>Stop the sample data generation</strong> ) and select data from cloneeventtest table. We will see more rows, as expected.</p>
</li>
</ul>
<ol start="7">
<li>Run the pgbench workload on the Clone Cluster</li>
</ol>
<ul>
<li>
<p>We are going to start a similar pgbench workload on the newly created clone cluster as we did on the primary cluster earlier in step#1. Replace <!-- raw HTML omitted --> below with the Writer endpoint for your Cloned Aurora cluster.</p>
<pre tabindex="0"><code>pgbench --progress-timestamp -M prepared -n -T 1800 -P 60 -c 8 -j 8 --host=&lt;Cloned Cluster Writer Endpoint&gt; -b tpcb-like@1 -b select-only@20 &gt; Clone_results.log
</code></pre></li>
</ul>
<ol start="8">
<li>Verify the pgbench metrics on the primary and the clone cluster.</li>
</ol>
<ul>
<li>Once the pgbench workload completes on both the primary and the clone cluster, we can verify the TPS metrics from both the clusters by looking at the output file.
<img alt="FC" src="/images/3.1/9.png">
<img alt="FC" src="/images/3.1/10.png"></li>
</ul>





<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-preparation/2-6-configurecloud9andinitializedatabase/" title=" Create, Configure Cloud9 and Initialize Database"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/4-queryplanmanagement/" title="Query Plan Management" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1711417761"></script>
    <script src="/js/perfect-scrollbar.min.js?1711417761"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1711417761"></script>
    <script src="/js/jquery.sticky.js?1711417761"></script>
    <script src="/js/featherlight.min.js?1711417761"></script>
    <script src="/js/highlight.pack.js?1711417761"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1711417761"></script>
    <script src="/js/learn.js?1711417761"></script>
    <script src="/js/hugo-learn.js?1711417761"></script>

    <link href="/mermaid/mermaid.css?1711417761" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1711417761"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
